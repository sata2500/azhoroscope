// AZ-Horoscope Veritabanı Şeması
// Prisma ORM ile SQLite (geliştirme) / PostgreSQL (üretim) desteği
// Daha fazla bilgi: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ==========================================
// KULLANICI YÖNETİMİ
// ==========================================

/// Kullanıcı modeli - NextAuth ile entegre
model Kullanici {
  id                String    @id @default(cuid())
  email             String    @unique
  emailDogrulandi   DateTime?
  ad                String?
  soyad             String?
  resim             String?
  dogumTarihi       DateTime?
  dogumSaati        String?
  dogumYeri         String?
  burc              String?
  rol               Rol       @default(KULLANICI)
  olusturmaTarihi   DateTime  @default(now())
  guncellemeTarihi  DateTime  @updatedAt

  // İlişkiler
  hesaplar          Hesap[]
  oturumlar         Oturum[]
  doğumHaritasi     DogumHaritasi?
  gunlukYorumlar    GunlukYorum[]
  gunlukler         Gunluk[]

  @@map("kullanicilar")
}

/// Kullanıcı rolleri
enum Rol {
  KULLANICI
  ADMIN
  SUPER_ADMIN
}

/// OAuth hesap bilgileri - NextAuth için
model Hesap {
  id                String  @id @default(cuid())
  kullaniciId       String
  tip               String
  saglayici         String
  saglayiciHesapId  String
  yenilemeToken     String?
  erisimToken       String?
  tokenSonlanma     Int?
  tokenTipi         String?
  kapsam            String?
  idToken           String?
  oturumDurumu      String?

  kullanici         Kullanici @relation(fields: [kullaniciId], references: [id], onDelete: Cascade)

  @@unique([saglayici, saglayiciHesapId])
  @@map("hesaplar")
}

/// Oturum bilgileri - NextAuth için
model Oturum {
  id                String   @id @default(cuid())
  oturumToken       String   @unique
  kullaniciId       String
  sonlanmaTarihi    DateTime

  kullanici         Kullanici @relation(fields: [kullaniciId], references: [id], onDelete: Cascade)

  @@map("oturumlar")
}

/// Doğrulama tokenleri - NextAuth için
model DogrulamaToken {
  tanimlayici       String
  token             String   @unique
  sonlanmaTarihi    DateTime

  @@unique([tanimlayici, token])
  @@map("dogrulama_tokenleri")
}

// ==========================================
// ASTROLOJİ MODÜLLERİ
// ==========================================

/// Doğum haritası bilgileri
model DogumHaritasi {
  id                String    @id @default(cuid())
  kullaniciId       String    @unique
  
  // Gezegen konumları (derece cinsinden)
  gunes             Float?
  ay                Float?
  merkur            Float?
  venus             Float?
  mars              Float?
  jupiter           Float?
  saturn            Float?
  uranus            Float?
  neptun            Float?
  pluton            Float?
  
  // Yükselen burç
  yukselenBurc      String?
  yukselenDerece    Float?
  
  // Hesaplama bilgileri
  hesaplamaTarihi   DateTime  @default(now())
  guncellemeTarihi  DateTime  @updatedAt

  kullanici         Kullanici @relation(fields: [kullaniciId], references: [id], onDelete: Cascade)

  @@map("dogum_haritalari")
}

/// Günlük burç yorumları
model GunlukYorum {
  id                String    @id @default(cuid())
  kullaniciId       String?
  
  tarih             DateTime
  burc              String
  yorumTipi         YorumTipi @default(GUNLUK)
  yorum             String
  aiModeli          String?
  promptId          String?
  
  olusturmaTarihi   DateTime  @default(now())

  kullanici         Kullanici? @relation(fields: [kullaniciId], references: [id], onDelete: SetNull)

  @@index([tarih, burc])
  @@map("gunluk_yorumlar")
}

/// Yorum tipleri
enum YorumTipi {
  GUNLUK
  HAFTALIK
  AYLIK
  YILLIK
}

/// Kişisel günlük
model Gunluk {
  id                String    @id @default(cuid())
  kullaniciId       String
  
  tarih             DateTime
  ruhHali           String?
  notlar            String?
  
  olusturmaTarihi   DateTime  @default(now())
  guncellemeTarihi  DateTime  @updatedAt

  kullanici         Kullanici @relation(fields: [kullaniciId], references: [id], onDelete: Cascade)

  @@index([kullaniciId, tarih])
  @@map("gunlukler")
}

// ==========================================
// SİSTEM YÖNETİMİ
// ==========================================

/// AI model ayarları
model AiAyarlari {
  id                String    @id @default(cuid())
  ozellikAdi        String    @unique  // gunluk_yorum, dogum_haritasi_analiz vb.
  
  model             String    @default("gemini-1.5-flash")
  temperature       Float     @default(0.7)
  maxTokens         Int       @default(1024)
  prompt            String?
  
  aktif             Boolean   @default(true)
  olusturmaTarihi   DateTime  @default(now())
  guncellemeTarihi  DateTime  @updatedAt

  @@map("ai_ayarlari")
}

/// Sistem logları
model SistemLog {
  id                String    @id @default(cuid())
  seviye            LogSeviye @default(INFO)
  kategori          String
  mesaj             String
  detaylar          String?
  kullaniciId       String?
  
  olusturmaTarihi   DateTime  @default(now())

  @@index([seviye, olusturmaTarihi])
  @@map("sistem_loglari")
}

/// Log seviyeleri
enum LogSeviye {
  DEBUG
  INFO
  WARN
  ERROR
  FATAL
}
