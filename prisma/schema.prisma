// AZ-Horoscope Veritabanı Şeması
// Prisma ORM ile SQLite (geliştirme) / PostgreSQL (üretim) desteği
// NextAuth v5 Prisma Adapter uyumlu model isimleri
// Daha fazla bilgi: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==========================================
// KULLANICI YÖNETİMİ (NextAuth Compatible)
// ==========================================

/// Kullanıcı modeli - NextAuth Prisma Adapter uyumlu
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  emailVerified DateTime?
  name          String?
  image         String?

  // Özel alanlar
  birthDate  DateTime?
  birthTime  String?
  birthPlace String?
  zodiacSign String?
  role       Role      @default(USER)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  // İlişkiler
  accounts      Account[]
  sessions      Session[]
  birthChart    BirthChart?
  dailyReadings DailyReading[]
  journals      Journal[]

  @@map("kullanicilar")
}

/// Kullanıcı rolleri
enum Role {
  USER
  ADMIN
  SUPER_ADMIN
}

/// OAuth hesap bilgileri - NextAuth Prisma Adapter uyumlu
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("hesaplar")
}

/// Oturum bilgileri - NextAuth Prisma Adapter uyumlu
model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("oturumlar")
}

/// Doğrulama tokenleri - NextAuth Prisma Adapter uyumlu
model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("dogrulama_tokenleri")
}

// ==========================================
// ASTROLOJİ MODÜLLERİ
// ==========================================

/// Doğum haritası bilgileri
model BirthChart {
  id     String @id @default(cuid())
  userId String @unique

  // Gezegen konumları (derece cinsinden)
  sun     Float?
  moon    Float?
  mercury Float?
  venus   Float?
  mars    Float?
  jupiter Float?
  saturn  Float?
  uranus  Float?
  neptune Float?
  pluto   Float?

  // Yükselen burç
  ascendant       String?
  ascendantDegree Float?

  // Hesaplama bilgileri
  calculatedAt DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("dogum_haritalari")
}

/// Günlük burç yorumları
model DailyReading {
  id     String  @id @default(cuid())
  userId String?

  date        DateTime
  zodiacSign  String
  readingType ReadingType @default(DAILY)
  content     String
  aiModel     String?
  promptId    String?

  createdAt DateTime @default(now())

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([date, zodiacSign])
  @@map("gunluk_yorumlar")
}

/// Yorum tipleri
enum ReadingType {
  DAILY
  WEEKLY
  MONTHLY
  YEARLY
}

/// Kişisel günlük
model Journal {
  id     String @id @default(cuid())
  userId String

  date  DateTime
  mood  String?
  notes String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
  @@map("gunlukler")
}

// ==========================================
// SİSTEM YÖNETİMİ
// ==========================================

/// AI model ayarları
model AiSettings {
  id          String @id @default(cuid())
  featureName String @unique // daily_reading, birth_chart_analysis vb.

  model       String  @default("gemini-2.0-flash-exp")
  temperature Float   @default(0.7)
  maxTokens   Int     @default(1024)
  prompt      String?

  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("ai_ayarlari")
}

/// Sistem logları
model SystemLog {
  id       String   @id @default(cuid())
  level    LogLevel @default(INFO)
  category String
  message  String
  details  String?
  userId   String?

  createdAt DateTime @default(now())

  @@index([level, createdAt])
  @@map("sistem_loglari")
}

/// Log seviyeleri
enum LogLevel {
  DEBUG
  INFO
  WARN
  ERROR
  FATAL
}
